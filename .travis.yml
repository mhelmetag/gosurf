language: go

go:
  - master

before_install:
  - go get github.com/mitchellh/gox

script:
  - go get -t -v ./...
  - diff -u <(echo -n) <(gofmt -d .)
  - go vet $(go list ./... | grep -v /vendor/)
  - gox -osarch="linux/amd64 darwin/amd64 windows/amd64"
    -ldflags "-X main.Rev=`git rev-parse --short HEAD`"
    -verbose

deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: amHWSxL9BbjuXJjV9sGopc3j8uNgoy5XqqW1tcQe/f4YpQnk0aIIlNICyVSsX/VVggN1B9UvgOPPopvoEsdY3UtiLsl3Ji08zUo7cVKX/nPWPwtqxAwuNTDRQkDoE4kzpxx2+/FWsB/JrVsMnARo1+LHiT7b1ShQn4WR37p09lDYwVMJBgVmZcKPaVfSYBWMVZQ11DXMBaF+ILVpUkc5fvSLHrQFhpSlQTxq0mQMP/zfP2iqAM475bXFgjIBfnbp8JbxnDAJim/+cRJiztLDF1Sna+VEOzv0HHgIHAu0StYem/9SYyOh7SJUlWukHa+9UxbwYeH3x4t1ppOvLxUD09bbA4GAe9E+JCkY7M4eGz2E79pjU1JSiMBM1T74KOsXlT9hfeGfze+B5/maq9Ubv+w6AoEqFkImkbJzLudkxHS+IJy99PfmnFOwcYsBFnPfH9X8A8Wv+E2sCbJUHZp9pG51hyy5CSyzne2Xa7gmZrzBDcsq+FZkYUMx+oyTTqVYDM5lfLXGSKVMO3yboT/Xn7ySv6VtqLgnmUdKcCp8iVEwGx9YyXmOei44mHsTfBXxu90c/E9D9YGKLA2oLis4O1JomsU+zmWC5Cq+bUtaAU9U5m/Q9Y9MrMOoyzDz32v6eTrWRR9CX4GOdcnKMRVf9IyA0FGuN72+evEP9ZYDKuM=
  file:
    - gosurf_windows_amd64.exe
    - gosurf_darwin_amd64
    - gosurf_linux_amd64
  on:
    repo: mhelmetag/gosurf
    tags: true
